diff '--color=auto' -ur pytorch-v2.8.0.orig/third_party/kineto/libkineto/CMakeLists.txt pytorch-v2.8.0/third_party/kineto/libkineto/CMakeLists.txt
--- pytorch-v2.8.0.orig/third_party/kineto/libkineto/CMakeLists.txt	2025-08-07 20:05:14.630842544 +0200
+++ pytorch-v2.8.0/third_party/kineto/libkineto/CMakeLists.txt	2025-08-07 20:06:42.266479873 +0200
@@ -169,8 +169,8 @@
       CXX_STANDARD_REQUIRED YES
       CXX_EXTENSIONS NO)
 
-set(KINETO_COMPILE_OPTIONS "-DKINETO_NAMESPACE=libkineto")
-list(APPEND KINETO_COMPILE_OPTIONS "-DFMT_HEADER_ONLY")
+set(KINETO_COMPILE_OPTIONS "-DKINETO_NAMESPACE=libkineto"
+	${CMAKE_SHARED_LIBRARY_C_FLAGS})
 list(APPEND KINETO_COMPILE_OPTIONS "-DENABLE_IPC_FABRIC")
 list(APPEND KINETO_COMPILE_OPTIONS)
 if(NOT MSVC)
@@ -198,7 +198,7 @@
 target_compile_options(kineto_base PRIVATE "${KINETO_COMPILE_OPTIONS}")
 target_compile_options(kineto_api PRIVATE "${KINETO_COMPILE_OPTIONS}")
 
-if(NOT TARGET fmt)
+if(FALSE)
   if(NOT FMT_SOURCE_DIR)
     set(FMT_SOURCE_DIR "${LIBKINETO_THIRDPARTY_DIR}/fmt"
       CACHE STRING "fmt source directory from submodules")
@@ -216,9 +216,7 @@
   set(BUILD_SHARED_LIBS ${TEMP_BUILD_SHARED_LIBS} CACHE BOOL "Build shared libs" FORCE)
 endif()
 
-set(FMT_INCLUDE_DIR "${FMT_SOURCE_DIR}/include")
 message(STATUS "Kineto: FMT_SOURCE_DIR = ${FMT_SOURCE_DIR}")
-message(STATUS "Kineto: FMT_INCLUDE_DIR = ${FMT_INCLUDE_DIR}")
 if (NOT CUPTI_INCLUDE_DIR)
     set(CUPTI_INCLUDE_DIR "${CUDA_SOURCE_DIR}/extras/CUPTI/include")
 endif()
@@ -247,7 +245,6 @@
       $<BUILD_INTERFACE:${LIBKINETO_INCLUDE_DIR}>
       $<BUILD_INTERFACE:${LIBKINETO_SOURCE_DIR}>
       $<BUILD_INTERFACE:${DYNOLOG_INCLUDE_DIR}>
-      $<BUILD_INTERFACE:${FMT_INCLUDE_DIR}>
       $<BUILD_INTERFACE:${IPCFABRIC_INCLUDE_DIR}>
       $<BUILD_INTERFACE:${CUPTI_INCLUDE_DIR}>
       $<BUILD_INTERFACE:${CUDA_INCLUDE_DIRS}>
@@ -259,7 +256,6 @@
 endif()
 
 target_include_directories(kineto_api PUBLIC
-      $<BUILD_INTERFACE:${FMT_INCLUDE_DIR}>
       $<BUILD_INTERFACE:${LIBKINETO_INCLUDE_DIR}>)
 
 if(KINETO_LIBRARY_TYPE STREQUAL "static")
@@ -300,8 +296,6 @@
 if(DEFINED LIBKINETO_NOXPUPTI AND NOT LIBKINETO_NOXPUPTI)
   target_link_libraries(kineto "${XPU_xpupti_LIBRARY}")
 endif()
-target_link_libraries(kineto $<BUILD_INTERFACE:fmt::fmt-header-only>)
-add_dependencies(kineto fmt::fmt-header-only)
 
 install(TARGETS kineto EXPORT kinetoLibraryConfig
   ARCHIVE DESTINATION ${CMAKE_INSTALL_LIBDIR}
diff '--color=auto' -ur pytorch-v2.8.0.orig/third_party/kineto/libkineto/libkineto_defs.bzl pytorch-v2.8.0/third_party/kineto/libkineto/libkineto_defs.bzl
--- pytorch-v2.8.0.orig/third_party/kineto/libkineto/libkineto_defs.bzl	2025-08-06 19:08:03.000000000 +0200
+++ pytorch-v2.8.0/third_party/kineto/libkineto/libkineto_defs.bzl	2025-08-07 20:06:42.266548233 +0200
@@ -83,6 +83,7 @@
         "include/libkineto.h",
         "include/time_since_epoch.h",
         "include/output_base.h",
+        "src/ApproximateClock.h",
     ]
 
 # kineto code should be updated to not have to
diff '--color=auto' -ur pytorch-v2.8.0.orig/third_party/kineto/libkineto/src/ApproximateClock.h pytorch-v2.8.0/third_party/kineto/libkineto/src/ApproximateClock.h
--- pytorch-v2.8.0.orig/third_party/kineto/libkineto/src/ApproximateClock.h	2025-08-06 19:08:03.000000000 +0200
+++ pytorch-v2.8.0/third_party/kineto/libkineto/src/ApproximateClock.h	2025-08-07 20:09:37.146690540 +0200
@@ -10,6 +10,7 @@
 
 #pragma once
 
+#include <algorithm>
 #include <array>
 #include <chrono>
 #include <cstddef>
diff '--color=auto' -ur pytorch-v2.8.0.orig/third_party/kineto/libkineto/src/CuptiActivityProfiler.h pytorch-v2.8.0/third_party/kineto/libkineto/src/CuptiActivityProfiler.h
--- pytorch-v2.8.0.orig/third_party/kineto/libkineto/src/CuptiActivityProfiler.h	2025-08-06 19:08:03.000000000 +0200
+++ pytorch-v2.8.0/third_party/kineto/libkineto/src/CuptiActivityProfiler.h	2025-08-07 20:10:14.139075919 +0200
@@ -8,6 +8,7 @@
 
 #pragma once
 
+#include <algorithm>
 #include <atomic>
 #include <chrono>
 #include <deque>
